name: Bing Daily Wallpaper with slack

on:
  workflow_dispatch:
  schedule:
    # 每天日本时间 0:10 执行 (UTC+9 = UTC 15:10)
    - cron: '10 15 * * *'

jobs:
  download-and-notify:
    runs-on: ubuntu-latest

    env:                     # ✅ 在 job 级别设置环境变量
      SLACK_TOKEN: ${{ secrets.SLACK_TOKEN }}
      TZ: Asia/Tokyo         # 可选：也可以这里设时区

    steps:
      # 1️⃣ Checkout 仓库
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2️⃣ 下载壁纸
      - name: Run wallpaper script
        id: download
        run: |
          chmod +x ./scripts/get-wallpaper-slack.sh
          ./scripts/get-wallpaper-slack.sh
        continue-on-error: true  # 即使失败也继续执行

      # 3️⃣ Commit & Push 新壁纸
      - name: Commit & Push new wallpaper
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add wallpapers/
          git add logs/
          git commit -m "Add new Bing wallpaper and logs on $(date +'%Y-%m-%d')" || echo "No changes to commit"
          git push
        continue-on-error: true
